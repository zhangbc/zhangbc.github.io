<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">




  
  
  <link rel="stylesheet" media="all" href="/lib/Han/dist/han.min.css?v=3.3">




<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Django,">










<meta name="description" content="本系列为 Django 官方文档学习笔记。 文档地址：https://docs.djangoproject.com/zh-hans/3.2/contents/ 环境：macOS10.13.1 + python3.7.3 + Django3.2  一，初识 DjangoDjango 最初被设计用于具有快速开发需求的新闻类站点，目的是要实现简单快捷的网站开发。  设计模型  Django 无需数据库">
<meta name="keywords" content="Django">
<meta property="og:type" content="article">
<meta property="og:title" content="【Django基础】Django快速入门">
<meta property="og:url" content="https://zhangbc.github.io/2021/05/10/django_quick_start/index.html">
<meta property="og:site_name" content="天堂的鸽子">
<meta property="og:description" content="本系列为 Django 官方文档学习笔记。 文档地址：https://docs.djangoproject.com/zh-hans/3.2/contents/ 环境：macOS10.13.1 + python3.7.3 + Django3.2  一，初识 DjangoDjango 最初被设计用于具有快速开发需求的新闻类站点，目的是要实现简单快捷的网站开发。  设计模型  Django 无需数据库">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://zhangbc.github.io/images/django_20210510220903.png">
<meta property="og:updated_time" content="2021-05-10T15:45:05.515Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【Django基础】Django快速入门">
<meta name="twitter:description" content="本系列为 Django 官方文档学习笔记。 文档地址：https://docs.djangoproject.com/zh-hans/3.2/contents/ 环境：macOS10.13.1 + python3.7.3 + Django3.2  一，初识 DjangoDjango 最初被设计用于具有快速开发需求的新闻类站点，目的是要实现简单快捷的网站开发。  设计模型  Django 无需数据库">
<meta name="twitter:image" content="https://zhangbc.github.io/images/django_20210510220903.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>







  <title>【Django基础】Django快速入门 | 天堂的鸽子</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <a href="https://github.com/zhangbc" class="github-corner" aria-label="View source on GitHub"><svg width="149" height="149" viewbox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">天堂的鸽子</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">天道酬勤</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            日程表
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/aboutme.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-categories" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://zhangbc.github.io/2021/05/10/django_quick_start/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bocheng Zhang">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天堂的鸽子">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">【Django基础】Django快速入门</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-05-10T22:01:40+08:00">
                2021-05-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-line-chart"></i> 阅读
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          
            <span id="busuanzi_value_page_pv"></span>
          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数&#58;</span>
                
                <span title="字数">
                  7.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">时长 &asymp;</span>
                
                <span title="时长">
                  37
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body han-init-context" itemprop="articleBody">

      
      

      
        <blockquote>
<p>本系列为 <code>Django</code> 官方文档学习笔记。</p>
<p>文档地址：<a href="https://docs.djangoproject.com/zh-hans/3.2/contents/" target="_blank" rel="noopener">https://docs.djangoproject.com/zh-hans/3.2/contents/</a></p>
<p>环境：<code>macOS10.13.1 + python3.7.3 + Django3.2</code></p>
</blockquote>
<h1 id="一，初识-Django"><a href="#一，初识-Django" class="headerlink" title="一，初识 Django"></a>一，初识 Django</h1><p><code>Django</code> 最初被设计用于具有快速开发需求的新闻类站点，目的是要实现简单快捷的网站开发。</p>
<ul>
<li>设计模型</li>
</ul>
<p><code>Django</code> 无需数据库就可以使用，它提供了 <a href="https://en.wikipedia.org/wiki/Object-relational_mapping" target="_blank" rel="noopener">对象关系映射器</a>，通过此技术，可以使用 <code>Python</code> 代码来描述数据库结构。</p>
<ul>
<li>应用数据模型</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python manage.py makemigrations</span><br><span class="line">$ python manage.py migrate</span><br></pre></td></tr></table></figure>
<p>该 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/django-admin/#django-admin-makemigrations" target="_blank" rel="noopener"><code>makemigrations</code></a> 命令查找所有可用的模型，为任意一个在数据库中不存在对应数据表的模型创建迁移脚本文件。<a href="https://docs.djangoproject.com/zh-hans/3.2/ref/django-admin/#django-admin-migrate" target="_blank" rel="noopener"><code>migrate</code></a> 命令则运行这些迁移来自动创建数据库表。</p>
<ul>
<li><p>享用便捷的 <code>API</code></p>
</li>
<li><p>一个动态管理接口：并非徒有其表</p>
</li>
</ul>
<p>当模型完成定义，<code>Django</code> 就会自动生成一个专业的生产级 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/admin/" target="_blank" rel="noopener">管理接口</a> ——一个允许认证用户添加、更改和删除对象的 <code>Web</code> 站点。</p>
<ul>
<li><p>规划 <code>URLs</code></p>
</li>
<li><p>编写视图</p>
</li>
</ul>
<p>视图函数的执行结果只有两种：返回一个包含请求页面元素的 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/request-response/#django.http.HttpResponse" target="_blank" rel="noopener"><code>HttpResponse</code></a> 对象，或者是抛出 <a href="https://docs.djangoproject.com/zh-hans/3.2/topics/http/views/#django.http.Http404" target="_blank" rel="noopener"><code>Http404</code></a> 这类异常。至于执行过程中的其它的动作则由你决定。</p>
<p>一个视图的工作就是：从参数获取数据，装载一个模板，然后将根据获取的数据对模板进行渲染。</p>
<ul>
<li>设计模板</li>
</ul>
<p><code>Django</code> 允许设置搜索模板路径，这样可以最小化模板之间的冗余。在 <code>Django</code> 设置中，你可以通过 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-TEMPLATES-DIRS" target="_blank" rel="noopener"><code>DIRS</code></a> 参数指定一个路径列表用于检索模板。如果第一个路径中不包含任何模板，就继续检查第二个，以此类推。</p>
<h1 id="二，编写你的第一个-Django-应用，第-1-部分"><a href="#二，编写你的第一个-Django-应用，第-1-部分" class="headerlink" title="二，编写你的第一个 Django 应用，第 1 部分"></a>二，编写你的第一个 Django 应用，第 1 部分</h1><p>查看 <code>Django</code> 版本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  demo_django [master] ⚡  python -m django --version</span><br><span class="line">3.2</span><br></pre></td></tr></table></figure>
<p>创建项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  demo_django [master] django-admin startproject mysite</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysite/              ：项目的容器</span><br><span class="line">    manage.py        ：管理 Django 项目的命令行工具</span><br><span class="line">    mysite/          ：项目包，纯 Python 包</span><br><span class="line">        __init__.py  ：空文件，告诉 Python 这个目录应该被认为是一个 Python 包</span><br><span class="line">        settings.py  ：项目的配置文件</span><br><span class="line">        urls.py      ：项目的 URL 声明</span><br><span class="line">        asgi.py      ：项目运行在 ASGI 兼容的 Web 服务器上的入口</span><br><span class="line">        wsgi.py      ：项目运行在 WSGI 兼容的Web服务器上的入口</span><br></pre></td></tr></table></figure>
<p>运行项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py runserver</span><br><span class="line">Watching <span class="keyword">for</span> file changes with StatReloader</span><br><span class="line">Performing system checks...</span><br><span class="line"></span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line"></span><br><span class="line">You have 18 unapplied migration(s). Your project may not work properly until you apply the migrations <span class="keyword">for</span> app(s): admin, auth, contenttypes, sessions.</span><br><span class="line">Run <span class="string">'python manage.py migrate'</span> to apply them.</span><br><span class="line">April 18, 2021 - 15:57:47</span><br><span class="line">Django version 3.2, using settings <span class="string">'mysite.settings'</span></span><br><span class="line">Starting development server at http://127.0.0.1:8000/</span><br><span class="line">Quit the server with CONTROL-C.</span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">(base) ☁  mysite [master] ⚡  python manage.py runserver 8080</span><br></pre></td></tr></table></figure>
<ul>
<li>创建投票应用</li>
</ul>
<p>在 <code>Django</code> 中，每一个应用都是一个 <code>Python</code> 包，并且遵循着相同的约定。<code>Django</code> 自带一个工具，可以帮你生成应用的基础目录结构。</p>
<blockquote>
<p>应用是一个专门做某件事的网络应用程序——比如博客系统，或者公共记录的数据库，或者小型的投票程序；</p>
<p>项目则是一个网站使用的配置和应用的集合。项目可以包含很多个应用；应用可以被很多个项目使用。</p>
</blockquote>
<p>创建 <code>polls</code> 应用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py startapp polls</span><br></pre></td></tr></table></figure>
<p>编写视图：</p>
<p>1）<code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</span><br></pre></td></tr></table></figure>
<p>2）<code>polls/urls.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>3）<code>mysite/urls.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> include</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">r'polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>函数 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/urls/#django.urls.path" target="_blank" rel="noopener"><code>path()</code></a> 具有四个参数，两个必须参数：<code>route</code> 和 <code>view</code>，两个可选参数：<code>kwargs</code> 和 <code>name</code>。</p>
<blockquote>
<p><code>route</code>：是一个匹配 <code>URL</code> 的准则。当 <code>Django</code> 响应一个请求时，它会从 <code>urlpatterns</code> 的第一项开始，按顺序依次匹配列表中的项，直到找到匹配的项，注意：这些准则不会匹配 <code>GET</code> 和 <code>POST</code> 参数或域名；</p>
<p><code>view</code>：当 <code>Django</code> 找到了一个匹配的准则，就会调用这个特定的视图函数，并传入一个 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/request-response/#django.http.HttpRequest" target="_blank" rel="noopener"><code>HttpRequest</code></a> 对象作为第一个参数，被“捕获”的参数以关键字参数的形式传入；</p>
<p><code>kwargs</code>：任意个关键字参数可以作为一个字典传递给目标视图函数；</p>
<p><code>name</code> ：为 <code>URL</code> 取名能使你在 <code>Django</code> 的任意地方唯一地引用它，尤其是在模板中。这个有用的特性允许你只改一个文件就能全局地修改某个 <code>URL</code> 模式。</p>
</blockquote>
<h1 id="三，编写你的第一个-Django-应用，第-2-部分"><a href="#三，编写你的第一个-Django-应用，第-2-部分" class="headerlink" title="三，编写你的第一个 Django 应用，第 2 部分"></a>三，编写你的第一个 Django 应用，第 2 部分</h1><ul>
<li>数据库配置</li>
</ul>
<blockquote>
<ul>
<li><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-DATABASE-ENGINE" target="_blank" rel="noopener"><code>ENGINE</code></a> — 可选值有 <code>&#39;django.db.backends.sqlite3&#39;</code>，<code>&#39;django.db.backends.postgresql&#39;</code>，<code>&#39;django.db.backends.mysql&#39;</code>，或 <code>&#39;django.db.backends.oracle&#39;</code>。其它 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/databases/#third-party-notes" target="_blank" rel="noopener">可用后端</a>。</li>
<li><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-NAME" target="_blank" rel="noopener"><code>NAME</code></a> — 数据库的名称。如果你使用 <code>SQLite</code>，数据库将是一个文件，在这种情况下，<a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-NAME" target="_blank" rel="noopener"><code>NAME</code></a> 应该是此文件完整的绝对路径，包括文件名。默认值 <code>BASE_DIR / &#39;db.sqlite3&#39;</code> 将把数据库文件储存在项目的根目录。</li>
</ul>
</blockquote>
<p>编辑 <code>mysite/settings.py</code> 文件前，先设置 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-TIME_ZONE" target="_blank" rel="noopener"><code>TIME_ZONE</code></a> 为你自己时区。</p>
<p> <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-INSTALLED_APPS" target="_blank" rel="noopener"><code>INSTALLED_APPS</code></a> 默认包括了以下 <code>Django</code> 的自带应用：</p>
<blockquote>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/admin/#module-django.contrib.admin" target="_blank" rel="noopener"><code>django.contrib.admin</code></a> — 管理员站点；</p>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/topics/auth/#module-django.contrib.auth" target="_blank" rel="noopener"><code>django.contrib.auth</code></a> — 认证授权系统；</p>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/contenttypes/#module-django.contrib.contenttypes" target="_blank" rel="noopener"><code>django.contrib.contenttypes</code></a> — 内容类型框架；</p>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/topics/http/sessions/#module-django.contrib.sessions" target="_blank" rel="noopener"><code>django.contrib.sessions</code></a> — 会话框架；</p>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/messages/#module-django.contrib.messages" target="_blank" rel="noopener"><code>django.contrib.messages</code></a> — 消息框架；</p>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/staticfiles/#module-django.contrib.staticfiles" target="_blank" rel="noopener"><code>django.contrib.staticfiles</code></a> — 管理静态文件的框架。</p>
</blockquote>
<p>创建数据表：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py migrate</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying contenttypes.0001_initial... OK</span><br><span class="line">  Applying auth.0001_initial... OK</span><br><span class="line">  Applying admin.0001_initial... OK</span><br><span class="line">  Applying admin.0002_logentry_remove_auto_add... OK</span><br><span class="line">  Applying admin.0003_logentry_add_action_flag_choices... OK</span><br><span class="line">  Applying contenttypes.0002_remove_content_type_name... OK</span><br><span class="line">  Applying auth.0002_alter_permission_name_max_length... OK</span><br><span class="line">  Applying auth.0003_alter_user_email_max_length... OK</span><br><span class="line">  Applying auth.0004_alter_user_username_opts... OK</span><br><span class="line">  Applying auth.0005_alter_user_last_login_null... OK</span><br><span class="line">  Applying auth.0006_require_contenttypes_0002... OK</span><br><span class="line">  Applying auth.0007_alter_validators_add_error_messages... OK</span><br><span class="line">  Applying auth.0008_alter_user_username_max_length... OK</span><br><span class="line">  Applying auth.0009_alter_user_last_name_max_length... OK</span><br><span class="line">  Applying auth.0010_alter_group_name_max_length... OK</span><br><span class="line">  Applying auth.0011_update_proxy_permissions... OK</span><br><span class="line">  Applying auth.0012_alter_user_first_name_max_length... OK</span><br><span class="line">  Applying sessions.0001_initial... OK</span><br></pre></td></tr></table></figure>
<ul>
<li>创建模型</li>
</ul>
<p>模型是真实数据的简单明确的描述，它包含了储存的数据所必要的字段和行为。<code>Django</code> 遵循 <a href="https://docs.djangoproject.com/zh-hans/3.2/misc/design-philosophies/#dry" target="_blank" rel="noopener">DRY Principle</a> 。它的目标是开发者只需要定义数据模型，然后其它的杂七杂八代码都不用关心，它们会自动从模型生成。</p>
<p><code>Django</code> 的迁移代码是由你的模型文件自动生成的，它本质上是个历史记录，<code>Django</code> 可以用它来进行数据库的滚动更新，通过这种方式使其能够和当前的模型匹配。</p>
<p><code>polls/models.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>每个模型被表示为 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/instances/#django.db.models.Model" target="_blank" rel="noopener"><code>django.db.models.Model</code></a> 类的子类；每个模型有许多类变量，它们都表示模型里的一个数据库字段。</p>
<p>每个字段都是 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/fields/#django.db.models.Field" target="_blank" rel="noopener"><code>Field</code></a> 类的实例 - 比如，字符字段被表示为 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/fields/#django.db.models.CharField" target="_blank" rel="noopener"><code>CharField</code></a> ，日期时间字段被表示为 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/fields/#django.db.models.DateTimeField" target="_blank" rel="noopener"><code>DateTimeField</code></a> ，这将告诉 <code>Django</code> 每个字段要处理的数据类型。</p>
<p>每个 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/fields/#django.db.models.Field" target="_blank" rel="noopener"><code>Field</code></a> 类实例变量的名字（例如 <code>question_text</code> 或 <code>pub_date</code> ）也是字段名，所以最好使用对机器友好的格式。你将会在 <code>Python</code> 代码里使用它们，而数据库会将它们作为列名。</p>
<ul>
<li>激活模型</li>
</ul>
<p><code>mysite/settings.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'polls.apps.PollsConfig'</span>,</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>执行项目迁移命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py makemigrations polls</span><br><span class="line">Migrations <span class="keyword">for</span> <span class="string">'polls'</span>:</span><br><span class="line">  polls/migrations/0001_initial.py</span><br><span class="line">    - Create model Question</span><br><span class="line">    - Create model Choice</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/django-admin/#django-admin-sqlmigrate" target="_blank" rel="noopener"><code>sqlmigrate</code></a> 命令接收一个迁移的名称，然后返回对应的 <code>SQL</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py sqlmigrate polls 0001</span><br><span class="line">BEGIN;</span><br><span class="line">--</span><br><span class="line">-- Create model Question</span><br><span class="line">--</span><br><span class="line">CREATE TABLE <span class="string">"polls_question"</span> (<span class="string">"id"</span> <span class="built_in">integer</span> NOT NULL PRIMARY KEY AUTOINCREMENT, <span class="string">"question_text"</span> varchar(200) NOT NULL, <span class="string">"pub_date"</span> datetime NOT NULL);</span><br><span class="line">--</span><br><span class="line">-- Create model Choice</span><br><span class="line">--</span><br><span class="line">CREATE TABLE <span class="string">"polls_choice"</span> (<span class="string">"id"</span> <span class="built_in">integer</span> NOT NULL PRIMARY KEY AUTOINCREMENT, <span class="string">"choice_text"</span> varchar(200) NOT NULL, <span class="string">"votes"</span> <span class="built_in">integer</span> NOT NULL, <span class="string">"question_id"</span> bigint NOT NULL REFERENCES <span class="string">"polls_question"</span> (<span class="string">"id"</span>) DEFERRABLE INITIALLY DEFERRED);</span><br><span class="line">CREATE INDEX <span class="string">"polls_choice_question_id_c5b4b260"</span> ON <span class="string">"polls_choice"</span> (<span class="string">"question_id"</span>);</span><br><span class="line">COMMIT;</span><br></pre></td></tr></table></figure>
<p>项目检查：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py check</span><br><span class="line">System check identified no issues (<span class="number">0</span> silenced).</span><br></pre></td></tr></table></figure>
<p>运行迁移命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py migrate</span><br><span class="line">Operations to perform:</span><br><span class="line">  Apply all migrations: admin, auth, contenttypes, polls, sessions</span><br><span class="line">Running migrations:</span><br><span class="line">  Applying polls.0001_initial... OK</span><br></pre></td></tr></table></figure>
<ul>
<li>初识 <code>API</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py shell</span><br><span class="line">In [1]: from polls.models import Choice, Question</span><br><span class="line"></span><br><span class="line">In [2]: Question.objects.all()</span><br><span class="line">Out[2]: &lt;QuerySet []&gt;</span><br><span class="line"></span><br><span class="line">In [3]: from django.utils import timezone</span><br><span class="line"></span><br><span class="line">In [4]: q = Question(question_text=<span class="string">"What's new?"</span>, pub_date=timezone.now())</span><br><span class="line"></span><br><span class="line">In [5]: q.save()</span><br><span class="line"></span><br><span class="line">In [6]: q.id</span><br><span class="line">Out[6]: 1</span><br><span class="line"></span><br><span class="line">In [7]: q.question_text</span><br><span class="line">Out[7]: <span class="string">"What's new?"</span></span><br><span class="line"></span><br><span class="line">In [8]: q.pub_date</span><br><span class="line">Out[8]: datetime.datetime(2021, 4, 19, 15, 57, 42, 13321, tzinfo=&lt;UTC&gt;)</span><br><span class="line"></span><br><span class="line">In [9]: q.question_text=<span class="string">"What's up?"</span></span><br><span class="line"></span><br><span class="line">In [10]: Question.objects.all()</span><br><span class="line">Out[10]: &lt;QuerySet [&lt;Question: Question object (1)&gt;]&gt;</span><br></pre></td></tr></table></figure>
<p><code>polls/models.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    pub_date = models.DateTimeField(<span class="string">'date published'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.question_text</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.pub_date &gt;= timezone.now() - datetime.timedelta(days=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Choice</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    question = models.ForeignKey(Question, on_delete=models.CASCADE)</span><br><span class="line">    choice_text = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">    votes = models.IntegerField(default=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.choice_text</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">In [1]: from polls.models import Choice, Question</span><br><span class="line"></span><br><span class="line">In [2]: Question.objects.all()</span><br><span class="line">Out[2]: &lt;QuerySet [&lt;Question: What<span class="string">'s new?&gt;]&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [3]: Question.objects.filter(id=1)</span></span><br><span class="line"><span class="string">Out[3]: &lt;QuerySet [&lt;Question: What'</span>s new?&gt;]&gt;</span><br><span class="line"></span><br><span class="line">In [6]: from django.utils import timezone</span><br><span class="line"></span><br><span class="line">In [7]: current_year = timezone.now().year</span><br><span class="line"></span><br><span class="line">In [8]: Question.objects.get(pub_date__year=current_year)</span><br><span class="line">Out[8]: &lt;Question: What<span class="string">'s new?&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [11]: q = Question.objects.get(pk=1)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [12]: q.was_published_recently()</span></span><br><span class="line"><span class="string">Out[12]: True</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [22]: c=q.choice_set.filter(choice_text__startswith='</span>Just hacking<span class="string">')</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">In [23]: c.delete()</span></span><br><span class="line"><span class="string">Out[23]: (1, &#123;'</span>polls.Choice<span class="string">': 1&#125;)</span></span><br></pre></td></tr></table></figure>
<ul>
<li>介绍 <code>Django</code> 管理页面</li>
</ul>
<p>创建管理员账号：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py createsuperuser</span><br><span class="line">Username (leave blank to use <span class="string">'zhangbocheng'</span>): admin</span><br><span class="line">Email address: admin@os-easy.com</span><br><span class="line">Password:</span><br><span class="line">Password (again):</span><br><span class="line">The password is too similar to the username.</span><br><span class="line">This password is too short. It must contain at least 8 characters.</span><br><span class="line">This password is too common.</span><br><span class="line">Bypass password validation and create user anyway? [y/N]: y</span><br><span class="line">Superuser created successfully.</span><br></pre></td></tr></table></figure>
<p>启动服务：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  mysite [master] ⚡  python manage.py runserver 8080</span><br></pre></td></tr></table></figure>
<p>向管理页面中加入投票应用：</p>
<p><code>polls/admin.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line">admin.site.register(Question)</span><br></pre></td></tr></table></figure>
<h1 id="四，编写你的第一个-Django-应用，第-3-部分"><a href="#四，编写你的第一个-Django-应用，第-3-部分" class="headerlink" title="四，编写你的第一个 Django 应用，第 3 部分"></a>四，编写你的第一个 Django 应用，第 3 部分</h1><p><code>Django</code> 中的视图的概念是 <strong>一类具有相同功能和模板的网页的集合</strong>。</p>
<ul>
<li>编写更多的视图</li>
</ul>
<p><code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"Hello, world. You're at the polls index."</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"You're looking at question &#123;0&#125;."</span>.format(question_id))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    resp = <span class="string">"You're looking at the results of question &#123;0&#125;"</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(resp.format(question_id))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"You're voting on question &#123;0&#125;."</span>.format(question_id))</span><br></pre></td></tr></table></figure>
<p><code>polls/urls.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.index, name=<span class="string">'index'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/'</span>, views.detail, name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/results/'</span>, views.results, name=<span class="string">'results'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>每个视图必须要做的只有两件事：返回一个包含被请求页面内容的 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/request-response/#django.http.HttpResponse" target="_blank" rel="noopener"><code>HttpResponse</code></a> 对象，或者抛出一个异常，比如 <a href="https://docs.djangoproject.com/zh-hans/3.2/topics/http/views/#django.http.Http404" target="_blank" rel="noopener"><code>Http404</code></a> 。</p>
<p><code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    lastest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    output = <span class="string">', '</span>.join(q.question_text <span class="keyword">for</span> q <span class="keyword">in</span> lastest_question_list)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(output)</span><br></pre></td></tr></table></figure>
<p>首先，在 <code>polls</code> 目录里创建一个 <code>templates</code> 目录。<code>Django</code> 将会在这个目录里查找模板文件。</p>
<p>项目的 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-TEMPLATES" target="_blank" rel="noopener"><code>TEMPLATES</code></a> 配置项描述了 <code>Django</code> 如何载入和渲染模板。默认的设置文件设置了 <code>DjangoTemplates</code> 后端，并将 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-TEMPLATES-APP_DIRS" target="_blank" rel="noopener"><code>APP_DIRS</code></a> 设置成了 <code>True</code>。这一选项将会让 <code>DjangoTemplates</code> 在每个 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-INSTALLED_APPS" target="_blank" rel="noopener"><code>INSTALLED_APPS</code></a> 文件夹中寻找 “<code>templates</code>“ 子目录。</p>
<p>在 <code>templates</code> 目录里，再创建一个目录 <code>polls</code>，然后在其中新建一个文件 <code>index.html</code> 。换句话说，你的模板文件的路径应该是 <code>polls/templates/polls/index.html</code> 。因为<code>app_directories</code> 模板加载器是通过上述描述的方法运行的，所以 <code>Django</code> 可以引用到 <code>polls/index.html</code> 模板。</p>
<p><code>polls/templates/polls/index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Poll project<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    &#123;% if latest_question_list %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &#123;% for question in latest_question_list %&#125;</span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/polls/&#123;&#123; question.id &#125;&#125;/"</span>&gt;</span>&#123;&#123;question.question_text&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            &#123;% endfor %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            No polls are available.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>更新视图 <code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    template = loader.get_template(<span class="string">'polls/index.html'</span>)</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'latest_question_list'</span>: latest_question_list,</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> HttpResponse(template.render(context, request))</span><br></pre></td></tr></table></figure>
<p><code>render()</code>：载入模板，填充上下文，再返回由它生成的 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/request-response/#django.http.HttpResponse" target="_blank" rel="noopener"><code>HttpResponse</code></a> 对象。</p>
<p><code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">    latest_question_list = Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line">    context = &#123;</span><br><span class="line">        <span class="string">'latest_question_list'</span>: latest_question_list,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/index.html'</span>, context)</span><br></pre></td></tr></table></figure>
<ul>
<li>抛出 404 错误</li>
</ul>
<p><code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        question = Question.objects.get(pk=question_id)</span><br><span class="line">    <span class="keyword">except</span> Question.DoesNotExist:</span><br><span class="line">        <span class="keyword">raise</span> Http404(<span class="string">"Question does not exist!"</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure>
<p><code>polls/templates/polls/detail.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; question &#125;&#125;</span><br></pre></td></tr></table></figure>
<p><code>get_object_or_404()</code>：尝试用 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/querysets/#django.db.models.query.QuerySet.get" target="_blank" rel="noopener"><code>get()</code></a> 函数获取一个对象，如果不存在就抛出 <a href="https://docs.djangoproject.com/zh-hans/3.2/topics/http/views/#django.http.Http404" target="_blank" rel="noopener"><code>Http404</code></a> 错误。</p>
<p><code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">detail</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>模板系统</li>
</ul>
<p>去除模板中的硬编码 <code>URL</code>， <code>polls/templates/polls/index.html</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'detail' question.id %&#125;"</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>为 <code>URL</code> 名称添加命名空间</p>
<p><code>polls/urls.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app_name = <span class="string">'polls'</span></span><br></pre></td></tr></table></figure>
<p><code>polls/templates/polls/index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'polls:detail' question.id %&#125;/"</span>&gt;</span>&#123;&#123;question.question_text&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="五，编写你的第一个-Django-应用，第-4-部分"><a href="#五，编写你的第一个-Django-应用，第-4-部分" class="headerlink" title="五，编写你的第一个 Django 应用，第 4 部分"></a>五，编写你的第一个 Django 应用，第 4 部分</h1><ul>
<li>编写表单</li>
</ul>
<p><code>polls/templates/polls/detail.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% if error_message %&#125; <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123; error_message &#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"&#123;% url 'polls:vote' question.id %&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">  &#123;% csrf_token %&#125;</span><br><span class="line">  &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"radio"</span> <span class="attr">name</span>=<span class="string">"choice"</span> <span class="attr">id</span>=<span class="string">"choice&#123;&#123; forloop.counter &#125;&#125;"</span> <span class="attr">value</span>=<span class="string">"&#123;&#123; choice.id &#125;&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"choice&#123;&#123; forloop.counter &#125;&#125;"</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"vote"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">vote</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        selected_choice = question.choice_set.get(pk=request.POST[<span class="string">'choice'</span>])</span><br><span class="line">    <span class="keyword">except</span> (KeyError, Choice.DoesNotExist):</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'polls/detail.html'</span>, &#123;</span><br><span class="line">            <span class="string">'question'</span>: question,</span><br><span class="line">            <span class="string">'error_message'</span>: <span class="string">"You didn't select a choice."</span></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        selected_choice.votes += <span class="number">1</span></span><br><span class="line">        selected_choice.save()</span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(reverse(<span class="string">'polls:results'</span>, args=(question_id, )))</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">results</span><span class="params">(request, question_id)</span>:</span></span><br><span class="line">    question = get_object_or_404(Question, pk=question_id)</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'polls/result.html'</span>, &#123;<span class="string">'question'</span>: question&#125;)</span><br></pre></td></tr></table></figure>
<p><code>polls/templates/polls/results.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123; question.question_text &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">  &#123;% for choice in question.choice_set.all %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; choice.choice_text &#125;&#125; -- &#123;&#123; choice.votes &#125;&#125; vote &#123;&#123; choice.votes |pluralize &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url 'polls:detail' question.id %&#125;"</span>&gt;</span> Vote again?<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用通用视图</li>
</ul>
<p><code>Django</code> 提供一种快捷方式，叫做“<strong>通用视图</strong>”系统。</p>
<p>改良 <code>URLconf</code>：<code>polls/urls.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">''</span>, views.IndexView.as_view(), name=<span class="string">'index'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:pk&gt;/'</span>, views.DetailView.as_view(), name=<span class="string">'detail'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:pk&gt;/results/'</span>, views.ResultsView.as_view(), name=<span class="string">'results'</span>),</span><br><span class="line">    path(<span class="string">'&lt;int:question_id&gt;/vote/'</span>, views.vote, name=<span class="string">'vote'</span>)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>改良视图：<code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span><span class="params">(generic.ListView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'polls/index.html'</span></span><br><span class="line">    context_object_name = <span class="string">'latest_question_list'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Question.objects.order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailView</span><span class="params">(generic.DetailView)</span>:</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">'polls/detail.html'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResultsView</span><span class="params">(generic.DetailView)</span>:</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">'polls/results.html'</span></span><br></pre></td></tr></table></figure>
<p>默认情况下，通用视图 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/class-based-views/generic-display/#django.views.generic.detail.DetailView" target="_blank" rel="noopener"><code>DetailView</code></a> 使用一个叫做 <code>&lt;app name&gt;/&lt;model name&gt;_detail.html</code> 的模板；<a href="https://docs.djangoproject.com/zh-hans/3.2/ref/class-based-views/generic-display/#django.views.generic.list.ListView" target="_blank" rel="noopener"><code>ListView</code></a> 使用一个叫做 <code>&lt;app name&gt;/&lt;model name&gt;_list.html</code> 的默认模板</p>
<h1 id="六，编写你的第一个-Django-应用，第-5-部分"><a href="#六，编写你的第一个-Django-应用，第-5-部分" class="headerlink" title="六，编写你的第一个 Django 应用，第 5 部分"></a>六，编写你的第一个 Django 应用，第 5 部分</h1><ul>
<li>基本测试脚本编写</li>
</ul>
<p><strong>自动化测试</strong> 是由某个系统帮你自动完成的。当你创建好了一系列测试，每次修改应用代码后，就可以自动检查出修改后的代码是否还像你曾经预期的那样正常工作。</p>
<p><code>Bug</code> 复现：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] python manage.py shell </span><br><span class="line">Python 3.7.3 (default, Mar 27 2019, 16:54:48) </span><br><span class="line">Type 'copyright', 'credits' or 'license' for more information</span><br><span class="line">IPython 7.6.1 -- An enhanced Interactive Python. Type '?' for help.</span><br><span class="line"></span><br><span class="line">In [1]: import datetime                                                                                                                </span><br><span class="line"></span><br><span class="line">In [2]: from django.utils import timezone                                                                                              </span><br><span class="line"></span><br><span class="line">In [3]: from polls.models import Question                                                                                              </span><br><span class="line"></span><br><span class="line">In [4]: future_qestion = Question(pub_date=timezone.now() + datetime.timedelta(days=30))                                               </span><br><span class="line"></span><br><span class="line">In [5]: future_qestion.was_published_recently()                                                                                        </span><br><span class="line">Out[5]: True</span><br></pre></td></tr></table></figure>
<p>创建测试：<code>polls/tests.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> TestCase</span><br><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your tests here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionModelTests</span><span class="params">(TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_was_published_recently_with_future_question</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        was_published_recently() returns False for questions whose pub_date</span></span><br><span class="line"><span class="string">        is in the future.</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        time_future = timezone.now() + datetime.timedelta(days=<span class="number">30</span>)</span><br><span class="line">        future_question = Question(pub_date=time_future)</span><br><span class="line">        self.assertIs(future_question.was_published_recently(), <span class="literal">False</span>)</span><br></pre></td></tr></table></figure>
<p>运行测试：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  ppython manage.py test polls </span><br><span class="line">Creating test database for alias 'default'...</span><br><span class="line">System check identified no issues (0 silenced).</span><br><span class="line">F</span><br><span class="line">======================================================================</span><br><span class="line">FAIL: test_was_published_recently_with_future_question (polls.tests.QuestionModelTests)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File "/home/projects/demo_django/mysite/polls/tests.py", line 21, in test_was_published_recently_with_future_question</span><br><span class="line">    self.assertIs(future_question.was_published_recently(), False)</span><br><span class="line">AssertionError: True is not False</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 1 test in 0.001s</span><br><span class="line"></span><br><span class="line">FAILED (failures=1)</span><br><span class="line">Destroying test database for alias 'default'...</span><br></pre></td></tr></table></figure>
<p>修复 <code>Bug</code>：<code>polls/models.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span><span class="params">(self)</span>:</span></span><br><span class="line">  time_now = timezone.now()</span><br><span class="line">  <span class="keyword">return</span> timezone.now() - datetime.timedelta(days=<span class="number">1</span>) &lt;= self.pub_date &lt;= time_now</span><br></pre></td></tr></table></figure>
<ul>
<li>测试视图</li>
</ul>
<p><code>Django</code> 提供了一个供测试使用的 <a href="https://docs.djangoproject.com/zh-hans/3.2/topics/testing/tools/#django.test.Client" target="_blank" rel="noopener"><code>Client</code></a> 来模拟用户和视图层代码的交互。</p>
<p>在 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/django-admin/#django-admin-shell" target="_blank" rel="noopener"><code>shell</code></a> 中配置测试环境：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  ppython manage.py shell </span><br><span class="line">Python 3.7.3 (default, Mar 27 2019, 16:54:48) </span><br><span class="line">Type 'copyright', 'credits' or 'license' for more information</span><br><span class="line">IPython 7.6.1 -- An enhanced Interactive Python. Type '?' for help.</span><br><span class="line"></span><br><span class="line">In [1]: from django.test.utils import setup_test_environment                                                                           </span><br><span class="line"></span><br><span class="line">In [2]: setup_test_environment()</span><br></pre></td></tr></table></figure>
<p>导入 <a href="https://docs.djangoproject.com/zh-hans/3.2/topics/testing/tools/#django.test.TestCase" target="_blank" rel="noopener"><code>django.test.TestCase</code></a> 类：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [3]: from django.test import Client                                                                                                 </span><br><span class="line"></span><br><span class="line">In [4]: client = Client()</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [5]: response = client.get('/')                                                                                                     </span><br><span class="line">Not Found: /</span><br><span class="line"></span><br><span class="line">In [6]: response.status_code                                                                                                           </span><br><span class="line">Out[6]: 404</span><br><span class="line"></span><br><span class="line">In [7]: from django.urls import reverse                                                                                                </span><br><span class="line"></span><br><span class="line">In [8]: response = client.get(reverse('polls:index'))                                                                                  </span><br><span class="line"></span><br><span class="line">In [9]: response.status_code                                                                                                           </span><br><span class="line">Out[9]: 200</span><br><span class="line"></span><br><span class="line">In [10]: response.content                                                                                                              </span><br><span class="line">Out[10]:  ....</span><br><span class="line"></span><br><span class="line">In [11]: response.context                                                                                                              </span><br><span class="line">Out[11]: [...]</span><br><span class="line"></span><br><span class="line">In [12]: response.context_data                                                                                                         </span><br><span class="line">Out[12]: </span><br><span class="line">&#123;'paginator': None,</span><br><span class="line"> 'page_obj': None,</span><br><span class="line"> 'is_paginated': False,</span><br><span class="line"> 'object_list': &lt;QuerySet [&lt;Question: What's new?&gt;]&gt;,</span><br><span class="line"> 'latest_question_list': &lt;QuerySet [&lt;Question: What's new?&gt;]&gt;,</span><br><span class="line"> 'view': &lt;polls.views.IndexView at 0x1098759b0&gt;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [13]: response.context['latest_question_list']                                                                                      </span><br><span class="line">Out[13]: &lt;QuerySet [&lt;Question: What's new?&gt;]&gt;</span><br></pre></td></tr></table></figure>
<p>改善视图：<code>polls/views.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils <span class="keyword">import</span> timezone</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IndexView</span><span class="params">(generic.ListView)</span>:</span></span><br><span class="line">    template_name = <span class="string">'polls/index.html'</span></span><br><span class="line">    context_object_name = <span class="string">'latest_question_list'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Question.objects.filter(</span><br><span class="line">            pub_date__lte=timezone.now()</span><br><span class="line">        ).order_by(<span class="string">'-pub_date'</span>)[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailView</span><span class="params">(generic.DetailView)</span>:</span></span><br><span class="line">    model = Question</span><br><span class="line">    template_name = <span class="string">'polls/detail.html'</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_queryset</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> Question.objects.filter(</span><br><span class="line">            pub_date__lte=timezone.now()</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>编写测试类：<code>polls/tests.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_question</span><span class="params">(question_text, days)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Create a question with the given `question_text` and published the</span></span><br><span class="line"><span class="string">    given number of `days` offset to now (negative for questions published</span></span><br><span class="line"><span class="string">    in the past, positive for questions that have yet to be published).</span></span><br><span class="line"><span class="string">    :param question_text:</span></span><br><span class="line"><span class="string">    :param days:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    t = timezone.now() + datetime.timedelta(days=days)</span><br><span class="line">    <span class="keyword">return</span> Question.objects.create(question_text=question_text, pub_date=t)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionIndexViewTests</span><span class="params">(TestCase)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_no_questions</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        If no questions exist, an appropriate message is displayed.</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        response = self.client.get(reverse(<span class="string">'polls:index'</span>))</span><br><span class="line">        self.assertEqual(response.status_code, <span class="number">200</span>)</span><br><span class="line">        self.assertContains(response, <span class="string">"No polls are available."</span>)</span><br><span class="line">        self.assertQuerysetEqual(response.context[<span class="string">'latest_question_list'</span>], [])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_past_question</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Questions with a pub_date in the past are displayed on the</span></span><br><span class="line"><span class="string">        index page.</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        question = create_question(question_text=<span class="string">'Past question.'</span>, days=<span class="number">-30</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'polls:index'</span>))</span><br><span class="line">        self.assertQuerysetEqual(</span><br><span class="line">            response.context[<span class="string">'latest_question_list'</span>],</span><br><span class="line">            [question]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_future_question</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Questions with a pub_date in the future aren't displayed on</span></span><br><span class="line"><span class="string">        the index page.</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        create_question(question_text=<span class="string">'Future question.'</span>, days=<span class="number">30</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'polls:index'</span>))</span><br><span class="line">        self.assertContains(response, <span class="string">"No polls are available."</span>)</span><br><span class="line">        self.assertQuerysetEqual(</span><br><span class="line">            response.context[<span class="string">'latest_question_list'</span>],</span><br><span class="line">            []</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_future_past_question</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        Even if both past and future questions exist, only past questions</span></span><br><span class="line"><span class="string">        are displayed.</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        question = create_question(question_text=<span class="string">'Past question.'</span>, days=<span class="number">-30</span>)</span><br><span class="line">        create_question(question_text=<span class="string">'Future question.'</span>, days=<span class="number">30</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'polls:index'</span>))</span><br><span class="line">        self.assertQuerysetEqual(</span><br><span class="line">            response.context[<span class="string">'latest_question_list'</span>],</span><br><span class="line">            [question]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_two_past_question</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        The questions index page may display multiple questions.</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line"></span><br><span class="line">        question1 = create_question(question_text=<span class="string">'Past question 1.'</span>, days=<span class="number">-30</span>)</span><br><span class="line">        question2 = create_question(question_text=<span class="string">'Past question 2.'</span>, days=<span class="number">-5</span>)</span><br><span class="line">        response = self.client.get(reverse(<span class="string">'polls:index'</span>))</span><br><span class="line">        self.assertQuerysetEqual(</span><br><span class="line">            response.context[<span class="string">'latest_question_list'</span>],</span><br><span class="line">            [question2, question1]</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>
<p>关于测试的建议：</p>
<blockquote>
<p>1）对于每个模型和视图都建立单独的 <code>TestClass</code>；</p>
<p>2）每个测试方法只测试一个功能；</p>
<p>3）给每个测试方法起个能描述其功能的名字。</p>
</blockquote>
<h1 id="七，编写你的第一个-Django-应用，第-6-部分"><a href="#七，编写你的第一个-Django-应用，第-6-部分" class="headerlink" title="七，编写你的第一个 Django 应用，第 6 部分"></a>七，编写你的第一个 Django 应用，第 6 部分</h1><p> <code>django.contrib.staticfiles</code> 存在的意义：将各个应用的静态文件（和一些你指明的目录里的文件）统一收集起来，这样一来，在生产环境中，这些文件就会集中在一个便于分发的地方。</p>
<ul>
<li>自定义应用的界面和风格</li>
</ul>
<p>在 <code>polls</code> 目录下创建一个名为 <code>static</code> 的目录，<code>Django</code> 将在该目录下查找静态文件。</p>
<p>在刚创建的 <code>static</code> 文件夹中创建一个名为 <code>polls</code> 的文件夹，再在 <code>polls</code> 文件夹中创建一个名为 <code>style.css</code> 的文件。</p>
<p><code>polls/static/polls/style.css</code>：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">li</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: green;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background</span>: white <span class="built_in">url</span>(<span class="string">"images/background.gif"</span>) no-repeat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>polls/templates/polls/index.html</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"&#123;% static 'polls/style.css' %&#125;"</span> <span class="attr">type</span>=<span class="string">"text/css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Poll project<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  ..........</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h1 id="八，编写你的第一个-Django-应用，第-7-部分"><a href="#八，编写你的第一个-Django-应用，第-7-部分" class="headerlink" title="八，编写你的第一个 Django 应用，第 7 部分"></a>八，编写你的第一个 Django 应用，第 7 部分</h1><ul>
<li>自定义后台表单</li>
</ul>
<p>通过 <code>admin.site.register(Question)</code> 注册 <code>Question</code> 模型，<code>Django</code> 能够构建一个默认的表单用于展示。</p>
<p><code>polls/admin.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Register your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    </span><br><span class="line">    fields = [<span class="string">'pub_date'</span>, <span class="string">'question_text'</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">admin.site.register(Question, QuestionAdmin)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line"></span><br><span class="line">    fieldsets = [</span><br><span class="line">        (<span class="literal">None</span>, &#123;<span class="string">'fields'</span>: [<span class="string">'question_text'</span>]&#125;),</span><br><span class="line">        (<span class="string">'Date info'</span>, &#123;<span class="string">'fields'</span>: [<span class="string">'pub_date'</span>]&#125;)</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>
<ul>
<li>添加关联对象</li>
</ul>
<p>1）向后台注册 <code>Choice</code> ：<code>polls/admin.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Question, Choice</span><br><span class="line"></span><br><span class="line">admin.site.register(Choice)</span><br></pre></td></tr></table></figure>
<p>2）改进注册方式：<code>polls/admin.py</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChoiceInline</span><span class="params">(admin.TabularInline)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        继承 TabularInline 比 StackedInline 更紧凑</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">    </span><br><span class="line">    model = Choice</span><br><span class="line">    <span class="comment"># 默认提供3个足够的选项字段</span></span><br><span class="line">    extra = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line"></span><br><span class="line">    fieldsets = [</span><br><span class="line">        (<span class="literal">None</span>, &#123;<span class="string">'fields'</span>: [<span class="string">'question_text'</span>]&#125;),</span><br><span class="line">        (<span class="string">'Date info'</span>, &#123;<span class="string">'fields'</span>: [<span class="string">'pub_date'</span>],</span><br><span class="line">                       <span class="string">'classes'</span>: [<span class="string">'collapse'</span>]&#125;)</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    inlines = [ChoiceInline]</span><br></pre></td></tr></table></figure>
<ul>
<li>自定义后台更改列表</li>
</ul>
<p>默认情况下，<code>Django</code> 显示每个对象的 <code>str()</code> 返回的值。但有时如果我们能够显示单个字段，它会更有帮助。为此，使用 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_display" target="_blank" rel="noopener"><code>list_display</code></a> 后台选项，它是一个包含要显示的字段名的元组，在更改列表页中以列的形式展示这个对象。</p>
<p><code>polls/admin.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># .........</span></span><br><span class="line">    list_display = [<span class="string">'question_text'</span>, <span class="string">'pub_date'</span>, <span class="string">'was_published_recently'</span>]</span><br></pre></td></tr></table></figure>
<p>使用 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/admin/#django.contrib.admin.display" target="_blank" rel="noopener"><code>display()</code></a> 装饰器来改进 <code>polls/models.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Question</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># .....</span></span><br><span class="line"><span class="meta">    @admin.display(</span></span><br><span class="line">        boolean=<span class="literal">True</span>,</span><br><span class="line">        ordering=<span class="string">'pub_date'</span>,</span><br><span class="line">        description=<span class="string">'Published recently?'</span></span><br><span class="line">    )</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">was_published_recently</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># .....</span></span><br></pre></td></tr></table></figure>
<p>使用 <a href="https://docs.djangoproject.com/zh-hans/3.2/ref/contrib/admin/#django.contrib.admin.ModelAdmin.list_filter" target="_blank" rel="noopener"><code>list_filter</code></a>，<code>polls/admin.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QuestionAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># .....</span></span><br><span class="line">    list_filter = [<span class="string">'pub_date'</span>]</span><br><span class="line">    search_fields = [<span class="string">'question_text'</span>]</span><br></pre></td></tr></table></figure>
<ul>
<li>自定义后台界面和风格</li>
</ul>
<p><code>Django</code> 的后台由自己驱动，且它的交互接口采用 <code>Django</code> 自己的模板系统。</p>
<p>在工程目录（指包含 <code>manage.py</code> 的那个文件夹）内创建一个名为 <code>templates</code> 的目录。模板可放在你系统中任何 <code>Django</code> 能找到的位置。</p>
<p><code>mysite/settings.py</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 仔细检查路径， [BASE_DIR. / 'templates'] 官方写法不是很支持</span></span><br><span class="line"><span class="string">'DIRS'</span>: [os.path.join(BASE_DIR, <span class="string">'templates'</span>)],</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.djangoproject.com/zh-hans/3.2/ref/settings/#std:setting-TEMPLATES-DIRS" target="_blank" rel="noopener"><code>DIRS</code></a> 是一个包含多个系统目录的文件列表，用于在载入 <code>Django</code> 模板时使用，是一个待搜索路径。</p>
<p>在 <code>templates</code> 目录内创建名为 <code>admin</code> 的目录，随后，将存放 <code>Django</code> 默认模板的目录（<code>django/contrib/admin/templates</code>）内的模板文件 <code>admin/base_site.html</code> 复制到这个目录内。</p>
<p>查找 <code>Django</code> 源码位置：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  python -c <span class="string">"import django;print(django.__path__)"</span></span><br><span class="line">[<span class="string">'/anaconda3/lib/python3.7/site-packages/django'</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  cp /anaconda3/lib/python3.7/site-packages/django/contrib/admin/templates/admin/base_site.html templates/admin</span><br></pre></td></tr></table></figure>
<h1 id="九，进阶指南：如何编写可重用程序"><a href="#九，进阶指南：如何编写可重用程序" class="headerlink" title="九，进阶指南：如何编写可重用程序"></a>九，进阶指南：如何编写可重用程序</h1><p>可重用性是 <code>Python</code> 的根本。</p>
<blockquote>
<p>一个 <a href="https://docs.python.org/3/glossary.html#term-package" target="_blank" rel="noopener"><code>package</code></a> 提供了一组关联的 <code>Python</code> 代码的简单复用方式。一个包（“模块”）包含了一个或多个 <code>Python</code> 代码文件。</p>
<p>一个包通过 <code>import foo.bar</code> 或 <code>from foo import bar</code> 的形式导入。一个目录（例如 <code>polls</code>）要成为一个包，它必须包含一个特定的文件 <code>__init__.py</code>，即便这个文件是空的。</p>
<p><code>Django</code> 应用仅仅是专用于 <code>Django</code> 项目的 <code>Python</code> 包。应用会按照 <code>Django</code> 规则，创建好 <code>models</code>, <code>tests</code>, <code>urls</code>, 以及 <code>views</code> 等子模块。</p>
</blockquote>
<p>使用 <a href="https://pypi.org/project/setuptools/" target="_blank" rel="noopener">setuptools</a> 来打包程序。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  pip list | grep <span class="built_in">set</span></span><br><span class="line">setuptools                         41.0.1</span><br></pre></td></tr></table></figure>
<p>1）在 <code>Django</code> 项目目录外创建一个名为 <code>django-polls</code> 的文件夹，用于盛放 <code>polls</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  mkdir django-polls</span><br><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  ls</span><br><span class="line">README.md    django-polls mysite</span><br></pre></td></tr></table></figure>
<p>2）将 <code>polls</code> 目录移入 <code>django-polls</code> 目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  mv mysite/polls django-polls </span><br><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  ls django-polls </span><br><span class="line">polls</span><br></pre></td></tr></table></figure>
<p>3）创建一个名为 <code>django-polls/README.rst</code> 的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  vi django-polls/README.rst</span><br><span class="line">=====</span><br><span class="line">Polls</span><br><span class="line">=====</span><br><span class="line"></span><br><span class="line">Polls is a Django app to conduct Web-based polls. For each question,</span><br><span class="line">visitors can choose between a fixed number of answers.</span><br><span class="line"></span><br><span class="line">Detailed documentation is <span class="keyword">in</span> the <span class="string">"docs"</span> directory.</span><br><span class="line"></span><br><span class="line">Quick start</span><br><span class="line">-----------</span><br><span class="line"></span><br><span class="line">1. Add <span class="string">"polls"</span> to your INSTALLED_APPS setting like this::</span><br><span class="line"></span><br><span class="line">    INSTALLED_APPS = [</span><br><span class="line">        ...</span><br><span class="line">        <span class="string">'polls'</span>,</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">2. Include the polls URLconf <span class="keyword">in</span> your project urls.py like this::</span><br><span class="line"></span><br><span class="line">    path(<span class="string">'polls/'</span>, include(<span class="string">'polls.urls'</span>)),</span><br><span class="line"></span><br><span class="line">3. Run ``python manage.py migrate`` to create the polls models.</span><br><span class="line"></span><br><span class="line">4. Start the development server and visit http://127.0.0.1:8000/admin/</span><br><span class="line">   to create a poll (you<span class="string">'ll need the Admin app enabled).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">5. Visit http://127.0.0.1:8000/polls/ to participate in the poll.</span></span><br><span class="line"><span class="string">:wq!</span></span><br></pre></td></tr></table></figure>
<p>4）创建一个 <code>django-polls/LICENSE</code> 文件。选择一个非本教程使用的授权协议，但是要足以说明发布代码没有授权证书是不可能的 。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  vi django-polls/LICENSE</span><br></pre></td></tr></table></figure>
<p>5）创建 <code>setup.cfg</code> 和 <code>setup.py</code> 文件用于说明如何构建和安装应用的细节。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  vi django-polls/setup.cfg </span><br><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  vi django-polls/setup.py</span><br><span class="line">from setuptools import setup</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setup()</span><br><span class="line">:wq!</span><br></pre></td></tr></table></figure>
<p>6）默认包中只包含 <code>Python</code> 模块和包。为了包含额外文件，我们需要创建一个名为 <code>MANIFEST.in</code> 的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  vi django-polls/MANIFEST.in</span><br><span class="line">include LICENSE</span><br><span class="line">include README.rst</span><br><span class="line">recursive-include polls/static *</span><br><span class="line">recursive-include polls/templates *</span><br><span class="line">:wq!</span><br></pre></td></tr></table></figure>
<p>7）创建一个空目录 <code>django-polls/docs</code> 用于未来编写文档。额外添加一行至 <code>django-polls/MANIFEST.in</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  mkdir django-polls/docs</span><br><span class="line">(/anaconda3) ☁  demo_django [master] ⚡  vi django-polls/MANIFEST.in</span><br><span class="line">recursive-include docs *</span><br><span class="line">:wq!</span><br></pre></td></tr></table></figure>
<p>8）构建应用包通过 <code>ptyhon setup.py sdist</code> （在 <code>django-polls</code> 目录内）。这将创建一个名为 <code>`dist</code> 的目录并构建应用包， <code>django-polls-0.1.tar.gz</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  django-polls [master] ⚡  python setup.py sdist</span><br><span class="line">running sdist</span><br><span class="line">running egg_info</span><br><span class="line">creating django_polls.egg-info</span><br><span class="line">writing django_polls.egg-info/PKG-INFO</span><br><span class="line">writing dependency_links to django_polls.egg-info/dependency_links.txt</span><br><span class="line">writing requirements to django_polls.egg-info/requires.txt</span><br><span class="line">writing top-level names to django_polls.egg-info/top_level.txt</span><br><span class="line">writing manifest file <span class="string">'django_polls.egg-info/SOURCES.txt'</span></span><br><span class="line">reading manifest file <span class="string">'django_polls.egg-info/SOURCES.txt'</span></span><br><span class="line">reading manifest template <span class="string">'MANIFEST.in'</span></span><br><span class="line">warning: no files found matching <span class="string">'*'</span> under directory <span class="string">'docs'</span></span><br><span class="line">writing manifest file <span class="string">'django_polls.egg-info/SOURCES.txt'</span></span><br><span class="line">running check</span><br><span class="line">creating django-polls-0.1</span><br><span class="line">creating django-polls-0.1/django_polls.egg-info</span><br><span class="line">creating django-polls-0.1/polls</span><br><span class="line">creating django-polls-0.1/polls/migrations</span><br><span class="line">creating django-polls-0.1/polls/static</span><br><span class="line">creating django-polls-0.1/polls/static/polls</span><br><span class="line">creating django-polls-0.1/polls/static/polls/images</span><br><span class="line">creating django-polls-0.1/polls/templates</span><br><span class="line">creating django-polls-0.1/polls/templates/polls</span><br><span class="line">copying files to django-polls-0.1...</span><br><span class="line">copying LICENSE -&gt; django-polls-0.1</span><br><span class="line">copying MANIFEST.in -&gt; django-polls-0.1</span><br><span class="line">copying README.rst -&gt; django-polls-0.1</span><br><span class="line">copying setup.cfg -&gt; django-polls-0.1</span><br><span class="line">copying setup.py -&gt; django-polls-0.1</span><br><span class="line">copying django_polls.egg-info/PKG-INFO -&gt; django-polls-0.1/django_polls.egg-info</span><br><span class="line">copying django_polls.egg-info/SOURCES.txt -&gt; django-polls-0.1/django_polls.egg-info</span><br><span class="line">copying django_polls.egg-info/dependency_links.txt -&gt; django-polls-0.1/django_polls.egg-info</span><br><span class="line">copying django_polls.egg-info/requires.txt -&gt; django-polls-0.1/django_polls.egg-info</span><br><span class="line">copying django_polls.egg-info/top_level.txt -&gt; django-polls-0.1/django_polls.egg-info</span><br><span class="line">copying polls/__init__.py -&gt; django-polls-0.1/polls</span><br><span class="line">copying polls/admin.py -&gt; django-polls-0.1/polls</span><br><span class="line">copying polls/apps.py -&gt; django-polls-0.1/polls</span><br><span class="line">copying polls/models.py -&gt; django-polls-0.1/polls</span><br><span class="line">copying polls/tests.py -&gt; django-polls-0.1/polls</span><br><span class="line">copying polls/urls.py -&gt; django-polls-0.1/polls</span><br><span class="line">copying polls/views.py -&gt; django-polls-0.1/polls</span><br><span class="line">copying polls/migrations/0001_initial.py -&gt; django-polls-0.1/polls/migrations</span><br><span class="line">copying polls/migrations/__init__.py -&gt; django-polls-0.1/polls/migrations</span><br><span class="line">copying polls/static/.DS_Store -&gt; django-polls-0.1/polls/static</span><br><span class="line">copying polls/static/polls/.DS_Store -&gt; django-polls-0.1/polls/static/polls</span><br><span class="line">copying polls/static/polls/style.css -&gt; django-polls-0.1/polls/static/polls</span><br><span class="line">copying polls/static/polls/images/background.gif -&gt; django-polls-0.1/polls/static/polls/images</span><br><span class="line">copying polls/templates/polls/detail.html -&gt; django-polls-0.1/polls/templates/polls</span><br><span class="line">copying polls/templates/polls/index.html -&gt; django-polls-0.1/polls/templates/polls</span><br><span class="line">copying polls/templates/polls/results.html -&gt; django-polls-0.1/polls/templates/polls</span><br><span class="line">Writing django-polls-0.1/setup.cfg</span><br><span class="line">creating dist</span><br><span class="line">Creating tar archive</span><br><span class="line">removing <span class="string">'django-polls-0.1'</span> (and everything under it)</span><br></pre></td></tr></table></figure>
<p>9）安装应用包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  python -m pip install --user ../django-polls/dist/django-polls-0.1.tar.gz</span><br></pre></td></tr></table></figure>
<p>10）验证应用包安装，并相应启动工程项目，还原项目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  pip list | grep dj</span><br><span class="line">django-polls                       0.1      </span><br><span class="line"></span><br><span class="line">(base) ☁  mysite [master] ⚡  python manage.py runserver 8080</span><br></pre></td></tr></table></figure>
<p>11）卸载应用包。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(/anaconda3) ☁  mysite [master] ⚡  python -m pip uninstall django-polls</span><br></pre></td></tr></table></figure>
<p>12）构建虚拟环境。</p>
<p>如果使用的是 <code>Python 3.3</code> 或更高版本，则该<a href="https://docs.python.org/3/library/venv.html#module-venv" target="_blank" rel="noopener"><code>venv</code></a>模块是创建和管理虚拟环境的首选方式。<code>venv</code> 包含在<code>Python</code> 标准库中，不需要其他安装。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建环境</span></span><br><span class="line">(base) ☁  ~  python3 -m venv envs/env3.7.3</span><br><span class="line"><span class="comment"># 激活环境</span></span><br><span class="line">(base) ☁  ~  <span class="built_in">source</span> envs/env3.7.3/bin/activate</span><br><span class="line">(env3.7.3) (base) ☁  ~  <span class="built_in">which</span> python</span><br><span class="line">/Users/zhangbocheng/envs/env3.7.3/bin/python</span><br><span class="line"><span class="comment"># 离开环境</span></span><br><span class="line">(env3.7.3) (base) ☁  ~  deactivate</span><br><span class="line"><span class="comment"># 安装包</span></span><br><span class="line">(env3.7.3) (base) ☁  ~  pip install django==3.2</span><br></pre></td></tr></table></figure>
<h1 id="十，编写你的第一个-Django-补丁"><a href="#十，编写你的第一个-Django-补丁" class="headerlink" title="十，编写你的第一个 Django 补丁"></a>十，编写你的第一个 Django 补丁</h1><p>获得 <code>django</code> 开发版的副本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  projects  git <span class="built_in">clone</span> git@github.com:django/django.git</span><br><span class="line">(base) ☁  projects  du -d 1 -h  | grep django</span><br><span class="line">268M    ./django</span><br><span class="line">(base) ☁  projects  git <span class="built_in">clone</span> git@github.com:django/django.git --depth 1</span><br><span class="line">(base) ☁  projects  du -d 1 -h  | grep django</span><br><span class="line"> 64M    ./django</span><br></pre></td></tr></table></figure>
<p>你可以在用命令 <code>git clone</code> 下载仓库的时候加上参数 <code>--depth 1</code> 来跳过 <code>Django</code> 的提交历史，这大约能把下载大小从 <code>268MB</code> 减少到 <code>64MB</code>。</p>
<p>创建并激活虚拟环境：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  ~  python3 -m venv .virtualenvs/django3.2</span><br><span class="line">(base) ☁  ~  <span class="built_in">source</span> .virtualenvs/django3.2/bin/activate</span><br></pre></td></tr></table></figure>
<p>安装开发副本：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  ~  python -m pip install /home/projects/django</span><br></pre></td></tr></table></figure>
<p>安装相关依赖：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  tests [stable/3.2.x] ⚡  brew install libmemcached</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  django [stable/3.2.x] <span class="built_in">cd</span> tests</span><br><span class="line">(django3.2) (base) ☁  tests [stable/3.2.x] python -m pip install -r requirements/py3.txt</span><br></pre></td></tr></table></figure>
<p>运行测试套件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  tests [stable/3.2.x] ./runtests.py</span><br></pre></td></tr></table></figure>
<p>当 <code>Django</code> 的测试套件被执行时，将看到一个代表测试运行状态的字符流。 其中字符 <code>E</code> 表示测试中出现异常， <code>F</code> 表示测试中的一个断言失败，这两种情况都被认为测试结果失败。而 <code>x</code> 和 <code>s</code> 分别表示与期望结果不同和跳过测试，逗点则表示测试被通过。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">...............</span><br><span class="line">======================================================================</span><br><span class="line">ERROR: test_clearsessions_unsupported (sessions_tests.tests.ClearSessionsCommandTests)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">...............</span><br><span class="line">======================================================================</span><br><span class="line">ERROR: test_i18n_app_dirs (i18n.tests.WatchForTranslationChangesTests)</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">...............</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 14611 tests <span class="keyword">in</span> 797.425s</span><br><span class="line"></span><br><span class="line">FAILED (errors=2, skipped=1100, expected failures=4)</span><br><span class="line">................</span><br></pre></td></tr></table></figure>
<ul>
<li>运行单元测试</li>
</ul>
<p>使用 <code>tox</code> 运行测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  tests [stable/3.2.x] python -m pip install tox</span><br><span class="line">(django3.2) (base) ☁  tests [stable/3.2.x] tox</span><br></pre></td></tr></table></figure>
<p><code>tox</code> 是通用的<a href="https://pypi.org/project/virtualenv" target="_blank" rel="noopener"><code>virtualenv</code></a>管理和测试令行工具，旨在自动化和标准化 <code>Python</code> 中的测试。可用于：</p>
<blockquote>
<p>检查您的软件包是否使用不同的 <code>Python</code> 版本和解释器正确安装；</p>
<p>在每个环境中运行测试，配置您选择的测试工具；</p>
<p>充当持续集成服务器的前端，大大减少了样板并合并了 <code>CI</code> 和基于外壳的测试。</p>
</blockquote>
<p><code>tox</code> 工作流程：</p>
<p><img src="/images/django_20210510220903.png" alt="tox工作流"></p>
<p>创建补丁分支：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  django [stable/3.2.x] git ck -b ticket_99999</span><br><span class="line">Switched to a new branch <span class="string">'ticket_99999'</span></span><br><span class="line">(django3.2) (base) ☁  django [ticket_99999]</span><br></pre></td></tr></table></figure>
<p>前往 <code>Django</code> 的 <code>tests/shortcuts/</code> 文件夹，创建一个名为 <code>test_make_toast.py</code> 的新文件。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">为工单 #99999 写测试¶</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@Date:         2021/5/9 22:46</span></span><br><span class="line"><span class="string">@Author:       zhangbocheng</span></span><br><span class="line"><span class="string">@Version:      1.0.0</span></span><br><span class="line"><span class="string">@Contact:      zhangbocheng189@163.com</span></span><br><span class="line"><span class="string">@Description:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> make_toast</span><br><span class="line"><span class="keyword">from</span> django.test <span class="keyword">import</span> SimpleTestCase</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MakeToastTests</span><span class="params">(SimpleTestCase)</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test_make_toast</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.assertEqual(make_toast(), <span class="string">'toast'</span>)</span><br></pre></td></tr></table></figure>
<p>打开 <code>django/</code> 文件夹中的 <code>shortcuts.py</code> 文件，在文件末尾追加：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_toast</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'toast'</span></span><br></pre></td></tr></table></figure>
<p>运行测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  ./runtests.py shortcuts</span><br><span class="line"><span class="comment"># 从报错信息中可以发现需要重新安装django</span></span><br><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  python -m pip uninstall django</span><br><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  python -m pip install /home/projects/django</span><br><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  ./runtests.py shortcuts</span><br><span class="line">......</span><br><span class="line">----------------------------------------------------------------------</span><br><span class="line">Ran 6 tests <span class="keyword">in</span> 0.154s</span><br><span class="line"></span><br><span class="line">OK</span><br></pre></td></tr></table></figure>
<p>再次运行 <code>Django</code> 测试套件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  ./runtests.py</span><br></pre></td></tr></table></figure>
<p>打开文件 <code>docs/topics/http/shortcuts.txt</code> ，然后在文件末尾追加下记内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">``make_toast()``</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">.. function:: make_toast()</span><br><span class="line"></span><br><span class="line">.. versionadded:: 3.2</span><br><span class="line"></span><br><span class="line">Returns ``&apos;toast&apos;``.</span><br></pre></td></tr></table></figure>
<p>打开 <code>docs/releases/3.2.txt</code> 文件，即发布说明的最新版本文件，在小标题”<code>Minor Features</code>“下面添加一个说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:mod:`django.shortcuts`</span><br><span class="line">~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line"></span><br><span class="line">* The new :func:`django.shortcuts.make_toast` function returns ``&apos;toast&apos;``.</span><br></pre></td></tr></table></figure>
<p>准备提交：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  git add --all</span><br><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  git diff --cached</span><br><span class="line">(django3.2) (base) ☁  tests [ticket_99999] ⚡  git commit -m<span class="string">"Fixed #99999 -- Added a shortcut function to make toast."</span></span><br><span class="line">(django3.2) (base) ☁  tests [ticket_99999] git push origin origin ticket_99999</span><br></pre></td></tr></table></figure>
<h1 id="十一，项目问题及解决方案"><a href="#十一，项目问题及解决方案" class="headerlink" title="十一，项目问题及解决方案"></a>十一，项目问题及解决方案</h1><p>1，<code>zsh</code> 问题，具体描述如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  demo_django [master] gitk  </span><br><span class="line">zsh: <span class="built_in">command</span> not found: gitk</span><br></pre></td></tr></table></figure>
<p>解决方案：<a href="https://www.jianshu.com/p/7c6577dec016" target="_blank" rel="noopener">zsh: command not found: gitk</a></p>
<p>2，关联远程仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(base) ☁  demo_django [master] git remote add origin git@github.com:zhangbc/demo_django.git</span><br><span class="line">(base) ☁  demo_django [master] git push origin master</span><br></pre></td></tr></table></figure>
<p>3，修改 <code>git</code> 历史提交</p>
<p>解决方案：<a href="https://blog.csdn.net/sodaslay/article/details/72948722" target="_blank" rel="noopener">git 修改已提交的内容</a></p>
<h1 id="十二，参考资料"><a href="#十二，参考资料" class="headerlink" title="十二，参考资料"></a>十二，参考资料</h1><ul>
<li><a href="https://www.jianshu.com/p/7c6577dec016" target="_blank" rel="noopener">zsh: command not found: gitk</a></li>
<li><a href="https://blog.csdn.net/sodaslay/article/details/72948722" target="_blank" rel="noopener">git 修改已提交的内容</a></li>
<li><a href="https://www.exception.site/essay/how-to-free-use-pycharm-2020" target="_blank" rel="noopener">PyCharm 2021.1.1 激活码 安装教程 破解版下载 (亲测有用，永久激活，2021年4月30日更新~)</a></li>
</ul>

      
    </div>
    
    
    

    <div>
      
        
      
    </div>

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创技术分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/uploads/wechatpay.jpeg" alt="Bocheng Zhang 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/uploads/alipay.jpeg" alt="Bocheng Zhang 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Bocheng Zhang
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://zhangbc.github.io/2021/05/10/django_quick_start/" title="【Django基础】Django快速入门">https://zhangbc.github.io/2021/05/10/django_quick_start/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Django/" rel="tag"> <i class="fa fa-tag"> Django</i></a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/06/02/leetcode-lcof-03/" rel="next" title="【Leetcode刷题】题64. 求1+2+…+n">
                <i class="fa fa-chevron-left"></i> 【Leetcode刷题】题64. 求1+2+…+n
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/08/03/server-tencent-cloud/" rel="prev" title="【服务器入门】快速配置轻量应用服务器（腾讯云）">
                【服务器入门】快速配置轻量应用服务器（腾讯云） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
  <div id="gitalk-container"></div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.png" alt="Bocheng Zhang">
            
              <p class="site-author-name" itemprop="name">Bocheng Zhang</p>
              <p class="site-description motion-element" itemprop="description">每天积累一点，学习一点，只有不坚持的，没有做不到的！</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">68</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/TIANTANGDEGEZI" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-feed"></i>CSDN</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:zhangbocheng189@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://theme-next.iissnan.com/theme-settings.html" title="NexT文档" target="_blank">NexT文档</a>
                  </li>
                
              </ul>
            </div>
          

          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#一，初识-Django"><span class="nav-text">一，初识 Django</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#二，编写你的第一个-Django-应用，第-1-部分"><span class="nav-text">二，编写你的第一个 Django 应用，第 1 部分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三，编写你的第一个-Django-应用，第-2-部分"><span class="nav-text">三，编写你的第一个 Django 应用，第 2 部分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#四，编写你的第一个-Django-应用，第-3-部分"><span class="nav-text">四，编写你的第一个 Django 应用，第 3 部分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五，编写你的第一个-Django-应用，第-4-部分"><span class="nav-text">五，编写你的第一个 Django 应用，第 4 部分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#六，编写你的第一个-Django-应用，第-5-部分"><span class="nav-text">六，编写你的第一个 Django 应用，第 5 部分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#七，编写你的第一个-Django-应用，第-6-部分"><span class="nav-text">七，编写你的第一个 Django 应用，第 6 部分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#八，编写你的第一个-Django-应用，第-7-部分"><span class="nav-text">八，编写你的第一个 Django 应用，第 7 部分</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#九，进阶指南：如何编写可重用程序"><span class="nav-text">九，进阶指南：如何编写可重用程序</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十，编写你的第一个-Django-补丁"><span class="nav-text">十，编写你的第一个 Django 补丁</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十一，项目问题及解决方案"><span class="nav-text">十一，项目问题及解决方案</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#十二，参考资料"><span class="nav-text">十二，参考资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bocheng Zhang</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">本站字数统计&#58;</span>
    
    <span title="本站字数统计">200.4k</span>
  
</div>


  <div class="powered-by">版权归 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 所有</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 总访客
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 本站总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script scr="/js/scr/md5.min.js"></script>
   <script type="text/javascript">
        var gitalk = new Gitalk({
          clientID: 'c3e9e61886d65422eafe',
          clientSecret: '5e136f2fd1ac0f977bbb2853e5f5798ef45e05d4',
          repo: 'zhangbc.github.io',
          owner: 'zhangbc',
          admin: ['zhangbc'],
          id: location.pathname,
          distractionFreeMode: 'true'
        })
        gitalk.render('gitalk-container')
       </script>





  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  


  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  
  <script type="text/javascript" src="/js/src/exturl.js?v=5.1.4"></script>



  <!-- 代码块复制功能 -->
  <script type="text/javascript" src="/js/src/clipboard.min.js"></script>
  <script type="text/javascript" src="/js/src/clipboard-use.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
